<!doctype html><html lang=es><head><meta charset=utf-8><link rel="shortcut icon" href=https://luispe.github.io/blog/favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><title>Cuando el contexto importa - luispe</title>
<meta name=description content="Peque침os detalles pueden evitarnos grandes contratiempos"><meta name=author content="luispe"><meta property="og:url" content="https://luispe.github.io/blog/es/posts/when-the-context-matter/"><meta property="og:site_name" content="luispe"><meta property="og:title" content="Cuando el contexto importa"><meta property="og:description" content="Peque침os detalles pueden evitarnos grandes contratiempos"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-13T18:45:35-03:00"><meta property="article:modified_time" content="2022-06-13T18:45:35-03:00"><meta property="article:tag" content="Best-Practices"><meta property="article:tag" content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cuando el contexto importa"><meta name=twitter:description content="Peque침os detalles pueden evitarnos grandes contratiempos"><link rel=stylesheet href=/blog/style.min.2338eb9c66c01f41c1bffce87e87ab3319740a82e43f36025d401cc9fd148a50c5ef8006dfa3d577491113ec707c814ae5ff83a54ec7fe6e87b24c2e8edf8989.css integrity="sha512-IzjrnGbAH0HBv/zofoerMxl0CoLkPzYCXUAcyf0UilDF74AG36PVd0kRE+xwfIFK5f+DpU7H/m6Hskwujt+JiQ=="><link rel=stylesheet href=/blog/lib/css/prism.min.6226f06f992e0d6166b0e26724efd050dcc381202a752892ba523b1b865de2ea5e427f8f7d10de682fc35d6e7444018247d1f25db5e1e3bab17068ce191c5886.css integrity="sha512-Yibwb5kuDWFmsOJnJO/QUNzDgSAqdSiSulI7G4Zd4upeQn+PfRDeaC/DXW50RAGCR9HyXbXh47qxcGjOGRxYhg=="><script>"theme"in localStorage||(localStorage.theme="light"),localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light")</script><script defer src=/blog/js/header.64a5d751579791aca02cca13ec10c056a8bb0de07cc69a70f0ef401bb0f470f2360e07f1f6f4398e0681f9abd2c64b3cb9d167ee471fa2a07bb1943e06e0c02b.js integrity="sha512-ZKXXUVeXkaygLMoT7BDAVqi7DeB8xppw8O9AG7D0cPI2Dgfx9vQ5jgaB+avSxks8udFn7kcfoqB7sZQ+BuDAKw=="></script><script defer src=/blog/js/zooming.684b5d075bf94d0adfa21a7e7eb9acec1ddfb2e7b47d6657981617f0db0cf50949f1172801595afa3051f51b28d67f6a2d0c41be677b59b564307d9dbe4a4fd2.js integrity="sha512-aEtdB1v5TQrfohp+frms7B3fsue0fWZXmBYX8NsM9QlJ8RcoAVla+jBR9Rso1n9qLQxBvmd7WbVkMH2dvkpP0g=="></script><script defer src=/blog/js/prism.ea52843de9ef49f2fd5ada5a4e0efb81dd05ae250cb815846dfa3fb988498c70ae2cc567a635da79ffd407054622cea929e1b5fa00977f69c48e373b728cb9cd.js integrity="sha512-6lKEPenvSfL9WtpaTg77gd0FriUMuBWEbfo/uYhJjHCuLMVnpjXaef/UBwVGIs6pKeG1+gCXf2nEjjc7coy5zQ==" data-manual></script><script defer src=/blog/js/search-es.46e2acb375f3398d581143dd93b01bd20410d44cd876d67e537c0c1a08d891f80febe3710717ce36493dcb80379c798e553461eb0689dfd1a184e3f47efc064c.js integrity="sha512-RuKss3XzOY1YEUPdk7Ab0gQQ1EzYdtZ+U3wMGgjYkfgP6+NxBxfONkk9y4A3nHmOVTRh6waJ39GhhOP0fvwGTA=="></script></head><body><header><div id=header_left><div id=sidebar_btn><input type=checkbox id=sidebar_btn_input class=hidden>
<label id=sidebar_btn_label for=sidebar_btn_input><svg id="menu_icon" width="26" height="26" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</svg>
</label><label id=sidebar_canvas_overlay_wrapper for=sidebar_btn_input><div id=sidebar_canvas_overlay></div></label><div id=sidebar><ul><li><a href=/blog/about/>Acerca de</a></li><li><a href=/blog/posts/>Posts</a></li></ul></div></div><div class=brand><div><a href=/blog/es/>luispe</a></div></div></div><div class=toolbox><div id=theme_tool><svg id="dark_mode_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></svg><svg id="light_mode_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></svg></div><div id=search_tool><svg id="search_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></svg><div id=search_menu_wrapper class=hidden><div id=search_menu><div id=search_menu_toolbar><div id=search_menu_input_wrapper><input id=search_menu_input type=text placeholder='Search Posts'></div><div id=search_menu_close_btn><svg width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></svg></div></div><div id=search_menu_results></div></div></div></div><div id=translation_tool class="dropdown-wrapper pure-menu pure-menu-horizontal toolbox-btn" onclick="void 0"><ul class=pure-menu-list><li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover"><div class="dropdown-btn pure-menu-link"><svg width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3.0 014 10 15.3 15.3.0 01-4 10A15.3 15.3.0 018 12a15.3 15.3.0 014-10z"/></svg>
</svg>
<span class=dropdown-desc>Espa침ol</span></div><ul class=pure-menu-children><li class=pure-menu-item><a href=https://luispe.github.io/blog/ class=pure-menu-link>English</a></li><li class=pure-menu-item><a href=https://luispe.github.io/blog/es/ class=pure-menu-link>Espa침ol</a></li></ul></li></ul></div></div></header><nav id=navbar class=pure-menu><ul class=pure-menu-list><li class="navbar-item pure-menu-item"><a href=/blog/about/ class=pure-menu-link>Acerca de</a></li><li class="navbar-item pure-menu-item"><a href=/blog/posts/ class=pure-menu-link>Posts</a></li></ul></nav><main><div id=content class=content-margin><div class=collapsible-menu-wrapper><div class=collapsible-menu-type><span>Table of contents</span></div><div class=collapsible-menu><nav id=TableOfContents><ul><li><a href=#pre치mbulo>Pre치mbulo</a></li><li><a href=#propuestaaprendizaje>Propuesta/aprendizaje</a></li></ul></nav></div></div><div class=content-margin><article><p>La siguiente publicaci칩n se podr칤a decir que es una continuaci칩n de otra donde hablamos de como tener im치genes livianas
nos ayuda en muchos aspectos, si a칰n no pudiste leerla ac치 te dejo
<a href=https://luispe.github.io/blog/posts/lightweight-container-image/>el acceso</a>.</p><p>Hoy vamos a realizar una peque침a, pero importante mejora, y vamos a descubrir porque la estamos realizando.</p><h2>Pre치mbulo</h2><p>Como 칰ltima propuesta en la publicaci칩n que compart칤 anteriormente nos quedamos en este punto:</p><pre class="mc-prism hide language-text"><code># First layer use to build a Golang binary
FROM golang:1.18-alpine3.16 AS builder
WORKDIR /build
COPY go.mod go.sum ./
RUN go mod download &amp;&amp; go mod verify

COPY . ./
RUN GOOS=linux go build -o ./myapp ./path/to/main

# Final layer expose app to minimal docker image
FROM alpine:3.16.0

COPY --from=builder /build/myapp /myapp

ENTRYPOINT [&quot;/myapp&quot;]
</code></pre><p>Si tenemos como premisa que la tecnolog칤a de containers y su popularizaci칩n con Docker es disruptiva es en gran medida
por los beneficios de poder construir en diferentes lugares y no encontrarnos con sorpresas cuando iniciamos la aplicaci칩n
que est치 contenida en el container, te invito a que pensemos durante unos segundos/minutos o el tiempo que necesitemos.</p><p>쯉e puede realizar una mejora en la imagen para la aplicaci칩n de Golang?</p><p>La respuesta es si, 춰manos a la obra!</p><h2>Propuesta/aprendizaje</h2><p>Golang posee una caracter칤stica que es realmente poderosa, y no estoy hablando de las goroutines, y es la gran virtud de
poder realizar compilaci칩n cruzada.</p><p>쯈u칠 es compilaci칩n cruzada?, es la caracter칤stica de poder compilar desde un host con una determinada arquitectura y
sistema operativo (SO) el binario para otra arquitectura o SO.</p><p>Entonces para ser un poco m치s espec칤ficos podemos desde un host con SO = linux y arquitectura = amd64, compilar un binario
para SO = windows, arquitectura = 386 &#x1f525;.</p><p>Imaginemos ahora que donde corremos los contenedores para nuestras aplicaciones el c칩mputo es linux como SO y con
arquitectura amd64.</p><p>Con esto en mente realicemos una peque침a, pero importante mejora en nuestro Dockerfile.</p><pre class="mc-prism hide language-text"><code># First layer use to build a Golang binary
FROM golang:1.18-alpine3.16 AS builder
WORKDIR /build
COPY go.mod go.sum ./
RUN go mod download &amp;&amp; go mod verify

ENV GO111MODULE=on \
    CGO_ENABLED=0 \
    GOOS=linux \
    GOARCH=amd64

COPY . ./
RUN go build -o ./myapp ./path/to/main

# Final layer expose app to minimal docker image
FROM alpine:3.16.0

COPY --from=builder /build/myapp /myapp

ENTRYPOINT [&quot;/myapp&quot;]
</code></pre><p>Primero analicemos el cambio y porque lo realizamos.</p><pre class="mc-prism hide language-text"><code>ENV GO111MODULE=on \
    CGO_ENABLED=0 \
    GOOS=linux \
    GOARCH=amd64
</code></pre><p><code>CGO_ENABLED=0</code> desactivamos CGO</p><p><code>GOARCH=amd64</code> indicamos la arquitectura</p><p><code>GOOS=linux</code> indicamos el SO</p><p>Todo bien luispi, 쯣ero qu칠 ganancia obtuvimos?</p><p>Asegurarnos de compilar la aplicaci칩n para el entorno en el que va a ser ejecutado nos va a prevenir varios dolores de
cabeza o &ldquo;troubleshooting&rdquo;, y de m치s esta decir que ya no nos importa donde vamos a hacerlo (cualquiera sea nuestro canal
de integraci칩n continua), porque realizando la compilaci칩n, de nuevo, para el entorno en que va a ser ejecutado, nos
quedamos tranquilos de que estamos acortando el margen de contratiempos.</p><p>Para no aburrirte y por el momento hagamos una pausa.</p><p>춰Que pase bien! 游녦游낗</p></article></div></div></main></body></html>