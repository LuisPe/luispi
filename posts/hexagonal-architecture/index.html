<!doctype html><html lang=en><head><meta charset=utf-8><link rel="shortcut icon" href=https://luispe.github.io/blog/favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><title>Hexagonal Architecture - luispe</title>
<meta name=description content="How to decouple our system layers correctly"><meta name=author content="luispe"><meta property="og:url" content="https://luispe.github.io/blog/posts/hexagonal-architecture/"><meta property="og:site_name" content="luispe"><meta property="og:title" content="Hexagonal Architecture"><meta property="og:description" content="How to decouple our system layers correctly"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-09T21:53:34-03:00"><meta property="article:modified_time" content="2022-06-09T21:53:34-03:00"><meta property="article:tag" content="Best-Practices"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Go"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hexagonal Architecture"><meta name=twitter:description content="How to decouple our system layers correctly"><link rel=stylesheet href=/blog/style.min.2338eb9c66c01f41c1bffce87e87ab3319740a82e43f36025d401cc9fd148a50c5ef8006dfa3d577491113ec707c814ae5ff83a54ec7fe6e87b24c2e8edf8989.css integrity="sha512-IzjrnGbAH0HBv/zofoerMxl0CoLkPzYCXUAcyf0UilDF74AG36PVd0kRE+xwfIFK5f+DpU7H/m6Hskwujt+JiQ=="><link rel=stylesheet href=/blog/lib/css/prism.min.6226f06f992e0d6166b0e26724efd050dcc381202a752892ba523b1b865de2ea5e427f8f7d10de682fc35d6e7444018247d1f25db5e1e3bab17068ce191c5886.css integrity="sha512-Yibwb5kuDWFmsOJnJO/QUNzDgSAqdSiSulI7G4Zd4upeQn+PfRDeaC/DXW50RAGCR9HyXbXh47qxcGjOGRxYhg=="><script>"theme"in localStorage||(localStorage.theme="light"),localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light")</script><script defer src=/blog/js/header.64a5d751579791aca02cca13ec10c056a8bb0de07cc69a70f0ef401bb0f470f2360e07f1f6f4398e0681f9abd2c64b3cb9d167ee471fa2a07bb1943e06e0c02b.js integrity="sha512-ZKXXUVeXkaygLMoT7BDAVqi7DeB8xppw8O9AG7D0cPI2Dgfx9vQ5jgaB+avSxks8udFn7kcfoqB7sZQ+BuDAKw=="></script><script defer src=/blog/js/zooming.684b5d075bf94d0adfa21a7e7eb9acec1ddfb2e7b47d6657981617f0db0cf50949f1172801595afa3051f51b28d67f6a2d0c41be677b59b564307d9dbe4a4fd2.js integrity="sha512-aEtdB1v5TQrfohp+frms7B3fsue0fWZXmBYX8NsM9QlJ8RcoAVla+jBR9Rso1n9qLQxBvmd7WbVkMH2dvkpP0g=="></script><script defer src=/blog/js/prism.ea52843de9ef49f2fd5ada5a4e0efb81dd05ae250cb815846dfa3fb988498c70ae2cc567a635da79ffd407054622cea929e1b5fa00977f69c48e373b728cb9cd.js integrity="sha512-6lKEPenvSfL9WtpaTg77gd0FriUMuBWEbfo/uYhJjHCuLMVnpjXaef/UBwVGIs6pKeG1+gCXf2nEjjc7coy5zQ==" data-manual></script><script defer src=/blog/js/search-en.e2c44e92879386fcafd7745ceb3d7e022338f304fcc2ecc4a35453c1693ba996d9a360bd1e1daf3030ae2e052b0f0efd378adad6c7714d60a540e336953de39e.js integrity="sha512-4sROkoeThvyv13Rc6z1+AiM48wT8wuzEo1RTwWk7qZbZo2C9Hh2vMDCuLgUrDw79N4ra1sdxTWClQOM2lT3jng=="></script></head><body><header><div id=header_left><div id=sidebar_btn><input type=checkbox id=sidebar_btn_input class=hidden>
<label id=sidebar_btn_label for=sidebar_btn_input><svg id="menu_icon" width="26" height="26" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</svg>
</label><label id=sidebar_canvas_overlay_wrapper for=sidebar_btn_input><div id=sidebar_canvas_overlay></div></label><div id=sidebar><ul><li><a href=/blog/about/>About</a></li><li><a href=/blog/posts/>Posts</a></li></ul></div></div><div class=brand><div><a href=/blog/>luispe</a></div></div></div><div class=toolbox><div id=theme_tool><svg id="dark_mode_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></svg><svg id="light_mode_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></svg></div><div id=search_tool><svg id="search_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></svg><div id=search_menu_wrapper class=hidden><div id=search_menu><div id=search_menu_toolbar><div id=search_menu_input_wrapper><input id=search_menu_input type=text placeholder='Search Posts'></div><div id=search_menu_close_btn><svg width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></svg></div></div><div id=search_menu_results></div></div></div></div><div id=translation_tool class="dropdown-wrapper pure-menu pure-menu-horizontal toolbox-btn" onclick="void 0"><ul class=pure-menu-list><li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover"><div class="dropdown-btn pure-menu-link"><svg width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3.0 014 10 15.3 15.3.0 01-4 10A15.3 15.3.0 018 12a15.3 15.3.0 014-10z"/></svg>
</svg>
<span class=dropdown-desc>English</span></div><ul class=pure-menu-children><li class=pure-menu-item><a href=https://luispe.github.io/blog/ class=pure-menu-link>English</a></li><li class=pure-menu-item><a href=https://luispe.github.io/blog/es/ class=pure-menu-link>Espa√±ol</a></li></ul></li></ul></div></div></header><nav id=navbar class=pure-menu><ul class=pure-menu-list><li class="navbar-item pure-menu-item"><a href=/blog/about/ class=pure-menu-link>About</a></li><li class="navbar-item pure-menu-item insection"><a href=/blog/posts/ class=pure-menu-link>Posts</a></li></ul></nav><main><div id=content class=content-margin><div class=collapsible-menu-wrapper><div class=collapsible-menu-type><span>Table of contents</span></div><div class=collapsible-menu><nav id=TableOfContents><ul><li><a href=#preface>Preface</a></li><li><a href=#lets-start>Let&rsquo;s start</a></li><li><a href=#proposallearning>Proposal/learning</a></li></ul></nav></div></div><div class=content-margin><article><p>This is the first of a series where we will review different development patterns that I made
mistakes and what is currently and what I understand so far, the best way to apply it.</p><p>As the title of the publication says, today I want to talk about hexagonal architecture.</p><h2 id=preface class=header-anchor-wrapper>Preface
<a href=#preface class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h2><p>I have been noticing a lot of &ldquo;hype&rdquo; around the hexagonal architecture and I would like to be clear about it,
I am not against it, on the contrary, I think it is an excellent pattern.</p><p>But I think we fall into the mistake of applying the publishing recipes of &ldquo;medium&rdquo; and not only end up
with all the layers of our system coupled but with package names like &ldquo;adapters&rdquo; or &ldquo;ports&rdquo; and if there is
something beautiful in the language of Go(lang) is the intentionality in the name of a package.</p><blockquote><p>A good name on the package means that almost nothing else is needed to express the intentionality of the package.</p></blockquote><p>I share and recommend you to read the following <a href=https://go.dev/blog/package-names>official publication</a>,
personal opinion, applies to any language.</p><h2 id=lets-start class=header-anchor-wrapper>Let&rsquo;s start
<a href=#lets-start class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h2><blockquote><p>Anti pattern</p><p>Annotation in our domain model e.g <code>json</code>.</p></blockquote><p>One mistake I used to make is having <code>json</code> or <code>gorm</code> annotations or any annotations in the domain model.</p><p>Let&rsquo;s imagine that we have our <code>/user/user.go</code> model with the following content</p><pre class="mc-prism hide language-text"><code class=language-go>type User struct {
	FirstName string `json:&quot;first_name&quot;`
	LastName  string `json:&quot;last_name&quot;`
}
</code></pre><p>Before reading on, I invite you to take a few seconds/minutes to reflect on why this is an anti-pattern.</p><h2 id=proposallearning class=header-anchor-wrapper>Proposal/learning
<a href=#proposallearning class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h2><p>Our model should be presentation and data layer agnostic, therefore, it should not contain any annotations.
We should map the data to our model and vice versa, here is an example of what a rest HTTP controller
would look like e.g.:</p><p><code>user/rest_controller.go</code></p><pre class="mc-prism hide language-text"><code class=language-go>type UserDTO struct {
	FirstName string `json:&quot;first_name&quot;`
	LastName  string `json:&quot;last_name&quot;`
}

func (ctrl *controller) toUserModel(userDTO *UserDTO) *User {
	return &amp;User{
		FirstName:	userDTO.FirstName,
		LastName:	userDTO.LastName,
	}
}

func (ctrl *controller) toUserDTO(user *User) *UserDTO {
	return &amp;UserDTO{
		FirstName:	user.FirstName,
		LastName:	user.LastName,
	}
}
</code></pre><p>As we can see in the previous example the private methods in the rest controller map from the <code>data transfer object</code>
to the domain model when we call the service and vice versa.</p><p>Finally, we remove the annotations in our <code>user/user.go</code> model.</p><pre class="mc-prism hide language-text"><code class=language-go>type User struct {
	FirstName string
	LastName  string
}
</code></pre><p>All good luispi, but what gain did we get?</p><p>Now our <code>/user/user.go</code> not having any annotation no matter how we present or how we obtain/persist the data,
we will never touch the core/domain of our application, now we could affirm that our core/domain is agnostic
to the presentation or data layers gaining flexibility, testing, etc.</p><p>So as not to bore you and for the moment let&rsquo;s take a break.</p><p>Soon we will continue with small publications where we will try to rethink other anti-patterns.</p><p>Have a good time! üëãüèΩ</p></article></div></div></main></body></html>