
















<!DOCTYPE html>
<html lang='es'><head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <link rel="shortcut icon" href='http://localhost:1313/blog/favicon.ico' type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cuando el contexto importa - luispe</title>

    
    <meta name="description" content="Pequeños detalles pueden evitarnos grandes contratiempos" />
    

    

    
    <meta name="author" content="luispe" />
    

    
        <meta property="og:url" content="http://localhost:1313/blog/es/posts/when-the-context-matter/">
  <meta property="og:site_name" content="luispe">
  <meta property="og:title" content="Cuando el contexto importa">
  <meta property="og:description" content="Pequeños detalles pueden evitarnos grandes contratiempos">
  <meta property="og:locale" content="es">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-06-13T18:45:35-03:00">
    <meta property="article:modified_time" content="2022-06-13T18:45:35-03:00">
    <meta property="article:tag" content="Best-Practices">
    <meta property="article:tag" content="Docker">

    

    
        
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Cuando el contexto importa">
  <meta name="twitter:description" content="Pequeños detalles pueden evitarnos grandes contratiempos">

    <link rel="stylesheet" href="/blog/style.css" integrity="">



    <link rel="stylesheet" href="/blog/lib/css/prism.css" integrity="">



    
    <script>
        if (!('theme' in localStorage)) {
            localStorage.theme = 'light';
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute("data-theme", "dark");
        } else {
            document.documentElement.setAttribute("data-theme", "light");
        }
    </script>
<script defer src="/blog/js/header.js" integrity=""></script>



    <script defer src="/blog/js/zooming.js" integrity=""></script>







    
        

        
        

        
        
            
        

        <script defer src="/blog/js/prism.js" integrity="" data-manual></script>
    



    
    
    
    <script defer src="/blog/js/search-es.js" integrity=""></script>






    
</head>
<body><header>
    <div id="header_left">
        <div id="sidebar_btn">
            <input type="checkbox" id="sidebar_btn_input" class="hidden" />
            <label id="sidebar_btn_label" for="sidebar_btn_input">
                <svg id="menu_icon" width="26px" height="26px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
</svg>

</svg>
            </label>
            <label id="sidebar_canvas_overlay_wrapper" for="sidebar_btn_input">
                <div id="sidebar_canvas_overlay"></div>
            </label>
            <div id="sidebar">
                <ul><li>
                            <a href="/blog/about/">Acerca de</a></li><li>
                            <a href="/blog/posts/">Posts</a></li></ul>
            </div>
        </div>
    
        <div class="brand">
            <div>
                <a href="/blog/es/">luispe</a>
            </div>
        </div>
    </div>

    <div class="toolbox">
        <div id="theme_tool">
            <svg id="dark_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

</svg>
            <svg id="light_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>

</svg>
        </div>

        
            <div id="search_tool">
                <svg id="search_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
</svg>

</svg><div id="search_menu_wrapper" class="hidden">
    <div id="search_menu">
        <div id="search_menu_toolbar">
            <div id="search_menu_input_wrapper">
                <input id="search_menu_input" type="text" placeholder='Search Posts'>
            </div>
            <div id="search_menu_close_btn">
                <svg width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
</svg>

</svg>
            </div>
        </div>
        <div id="search_menu_results">
        </div>
    </div>
</div>
</div>
        

        
            <div id="translation_tool" class="dropdown-wrapper pure-menu pure-menu-horizontal toolbox-btn" onclick="void(0)">
                <ul class="pure-menu-list">
                    <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
                        <div class="dropdown-btn pure-menu-link">
                            <svg width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
</svg>

</svg>
                            <span class="dropdown-desc">Español</span>
                        </div>
                        <ul class="pure-menu-children">
                            
                            <li class="pure-menu-item">
                                <a href="http://localhost:1313/blog/" class="pure-menu-link">English</a>
                            </li>
                            
                            <li class="pure-menu-item">
                                <a href="http://localhost:1313/blog/es/" class="pure-menu-link">Español</a>
                            </li>
                            
                        </ul>
                    </li>
                </ul>
            </div>
        
    </div>
</header>
<nav id="navbar" class="pure-menu">
    <ul class="pure-menu-list"><li class="navbar-item pure-menu-item ">
                    
                        <a href="/blog/about/" class="pure-menu-link">Acerca de</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/blog/posts/" class="pure-menu-link">Posts</a>
                    
                </li></ul>
</nav>
<main>
            <div id="content" class="content-margin">
                
    
    <div class="collapsible-menu-wrapper"><div class="collapsible-menu-type"><span>Table of contents</span></div><div class="collapsible-menu">
        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#preámbulo">Preámbulo</a></li>
    <li><a href="#propuestaaprendizaje">Propuesta/aprendizaje</a></li>
  </ul>
</nav>
        
    </div></div>



    <div class="content-margin">



<article >
    
    
        
        
    
    <p>La siguiente publicación se podría decir que es una continuación de otra donde hablamos de como tener imágenes livianas
nos ayuda en muchos aspectos, si aún no pudiste leerla acá te dejo
<a href="https://luispe.github.io/blog/posts/lightweight-container-image/">el acceso</a>.</p>
<p>Hoy vamos a realizar una pequeña, pero importante mejora, y vamos a descubrir porque la estamos realizando.</p>

<h2>Preámbulo</h2>

<p>Como última propuesta en la publicación que compartí anteriormente nos quedamos en este punto:</p>
<pre  class="mc-prism hide language-text" ><code># First layer use to build a Golang binary
FROM golang:1.18-alpine3.16 AS builder
WORKDIR /build
COPY go.mod go.sum ./
RUN go mod download &amp;&amp; go mod verify

COPY . ./
RUN GOOS=linux go build -o ./myapp ./path/to/main

# Final layer expose app to minimal docker image
FROM alpine:3.16.0

COPY --from=builder /build/myapp /myapp

ENTRYPOINT [&quot;/myapp&quot;]
</code></pre>
<p>Si tenemos como premisa que la tecnología de containers y su popularización con Docker es disruptiva es en gran medida
por los beneficios de poder construir en diferentes lugares y no encontrarnos con sorpresas cuando iniciamos la aplicación
que está contenida en el container, te invito a que pensemos durante unos segundos/minutos o el tiempo que necesitemos.</p>
<p>¿Se puede realizar una mejora en la imagen para la aplicación de Golang?</p>
<p>La respuesta es si, ¡manos a la obra!</p>

<h2>Propuesta/aprendizaje</h2>

<p>Golang posee una característica que es realmente poderosa, y no estoy hablando de las goroutines, y es la gran virtud de
poder realizar compilación cruzada.</p>
<p>¿Qué es compilación cruzada?, es la característica de poder compilar desde un host con una determinada arquitectura y
sistema operativo (SO) el binario para otra arquitectura o SO.</p>
<p>Entonces para ser un poco más específicos podemos desde un host con SO = linux y arquitectura = amd64, compilar un binario
para SO = windows, arquitectura = 386 &#x1f525;.</p>
<p>Imaginemos ahora que donde corremos los contenedores para nuestras aplicaciones el cómputo es linux como SO y con
arquitectura amd64.</p>
<p>Con esto en mente realicemos una pequeña, pero importante mejora en nuestro Dockerfile.</p>
<pre  class="mc-prism hide language-text" ><code># First layer use to build a Golang binary
FROM golang:1.18-alpine3.16 AS builder
WORKDIR /build
COPY go.mod go.sum ./
RUN go mod download &amp;&amp; go mod verify

ENV GO111MODULE=on \
    CGO_ENABLED=0 \
    GOOS=linux \
    GOARCH=amd64

COPY . ./
RUN go build -o ./myapp ./path/to/main

# Final layer expose app to minimal docker image
FROM alpine:3.16.0

COPY --from=builder /build/myapp /myapp

ENTRYPOINT [&quot;/myapp&quot;]
</code></pre>
<p>Primero analicemos el cambio y porque lo realizamos.</p>
<pre  class="mc-prism hide language-text" ><code>ENV GO111MODULE=on \
    CGO_ENABLED=0 \
    GOOS=linux \
    GOARCH=amd64
</code></pre>
<p><code>CGO_ENABLED=0</code> desactivamos CGO</p>
<p><code>GOARCH=amd64</code> indicamos la arquitectura</p>
<p><code>GOOS=linux</code> indicamos el SO</p>
<p>Todo bien luispi, ¿pero qué ganancia obtuvimos?</p>
<p>Asegurarnos de compilar la aplicación para el entorno en el que va a ser ejecutado nos va a prevenir varios dolores de
cabeza o &ldquo;troubleshooting&rdquo;, y de más esta decir que ya no nos importa donde vamos a hacerlo (cualquiera sea nuestro canal
de integración continua), porque realizando la compilación, de nuevo, para el entorno en que va a ser ejecutado, nos
quedamos tranquilos de que estamos acortando el margen de contratiempos.</p>
<p>Para no aburrirte y por el momento hagamos una pausa.</p>
<p>¡Que pase bien! 👋🏽</p>

</article>
</div>


                
                    
                
            </div>
        </main>
</body>
</html>
